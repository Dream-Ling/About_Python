<html>
<head>
  <title>Python CGI编程</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600753 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="4317"/>
<h1>Python CGI编程</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>作者：</b></td><td><i>凌小康</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div><h1>Python CGI编程</h1><hr/><h2>什么是CGI</h2><p>CGI 目前由NCSA维护，NCSA定义CGI如下：</p><p>CGI(Common Gateway Interface),通用网关接口,它是一段程序,运行在服务器上如：HTTP服务器，提供同客户端HTML页面的接口。</p><hr/><h2>网页浏览</h2><p>为了更好的了解CGI是如何工作的，我们可以从在网页上点击一个链接或URL的流程：</p><ul><li>1、使用你的浏览器访问URL并连接到HTTP web 服务器。</li><li>2、Web服务器接收到请求信息后会解析URL，并查找访问的文件在服务器上是否存在，如果存在返回文件的内容，否则返回错误信息。</li><li>3、浏览器从服务器上接收信息，并显示接收的文件或者错误信息。</li></ul><p>CGI程序可以是Python脚本，PERL脚本，SHELL脚本，C或者C++程序等。</p><hr/><h2>CGI架构图</h2><p><img src="Python CGI编程_files/Image.png" type="image/png" data-filename="Image.png" alt="cgiarch" height="473" width="411"/></p><hr/><h2>Web服务器支持及配置</h2><p>在你进行CGI编程前，确保您的Web服务器支持CGI及已经配置了CGI的处理程序。</p><p>Apache 支持CGI 配置：</p><p>设置好CGI目录：</p><pre><span>ScriptAlias</span><span> </span><span>/</span><span>cgi</span><span>-</span><span>bin</span><span>/ /</span><span>var</span><span>/</span><span>www</span><span>/</span><span>cgi</span><span>-</span><span>bin</span><span>/</span></pre><p>所有的HTTP服务器执行CGI程序都保存在一个预先配置的目录。这个目录被称为CGI目录，并按照惯例，它被命名为/var/www/cgi-bin目录。</p><p>CGI文件的扩展名为.cgi，python也可以使用.py扩展名。</p><p>默认情况下，Linux服务器配置运行的cgi-bin目录中为/var/www。</p><p>如果你想指定其他运行 CGI 脚本的目录，可以修改 httpd.conf 配置文件，如下所示：</p><pre><span>&lt;Directory</span><span> </span><span>&quot;/var/www/cgi-bin&quot;</span><span>&gt;</span><span>
   AllowOverride None
   Options +ExecCGI
   Order allow,deny
   Allow from all
</span><span>&lt;/Directory&gt;</span></pre><p>在 AddHandler 中添加 .py 后缀，这样我们就可以访问 .py 结尾的 python 脚本文件：</p><pre><span>AddHandler</span><span> cgi</span><span>-</span><span>script </span><span>.</span><span>cgi </span><span>.</span><span>pl </span><span>.</span><span>py</span></pre><hr/><h2>第一个CGI程序</h2><p>我们使用Python创建第一个CGI程序，文件名为hello.py，文件位于/var/www/cgi-bin目录中，内容如下：</p><pre><span>#!/usr/bin/python</span><span>
</span><span># -*- coding: UTF-8 -*-</span><span>

</span><span>print</span><span> </span><span>&quot;Content-type:text/html&quot;</span><span>
</span><span>print</span><span>                               </span><span># 空行，告诉服务器结束头部</span><span>
</span><span>print</span><span> </span><span>'&lt;html&gt;'</span><span>
</span><span>print</span><span> </span><span>'&lt;head&gt;'</span><span>
</span><span>print</span><span> </span><span>'&lt;meta charset=&quot;utf-8&quot;&gt;'</span><span>
</span><span>print</span><span> </span><span>'&lt;title&gt;Hello World - 我的第一个 CGI 程序！&lt;/title&gt;'</span><span>
</span><span>print</span><span> </span><span>'&lt;/head&gt;'</span><span>
</span><span>print</span><span> </span><span>'&lt;body&gt;'</span><span>
</span><span>print</span><span> </span><span>'&lt;h2&gt;Hello World! 我是来自菜鸟教程的第一CGI程序&lt;/h2&gt;'</span><span>
</span><span>print</span><span> </span><span>'&lt;/body&gt;'</span><span>
</span><span>print</span><span> </span><span>'&lt;/html&gt;'</span></pre><p>文件保存后修改 hello.py，修改文件权限为 755：</p><pre><span>chmod </span><span>755</span><span> hello</span><span>.</span><span>py </span></pre><p>以上程序在浏览器访问 <strong>http://localhost/cgi-bin/hello.py</strong> 显示结果如下：</p><p></p><pre><span>Hello</span><span> </span><span>World</span><span>!</span><span> </span><span>我是来自菜鸟教程的第一</span><span>CGI</span><span>程序</span></pre><p>这个的hello.py脚本是一个简单的Python脚本，脚本第一行的输出内容&quot;Content-type:text/html&quot;发送到浏览器并告知浏览器显示的内容类型为&quot;text/html&quot;。</p><p>用 print 输出一个空行用于告诉服务器结束头部信息。</p><hr/><h2>HTTP头部</h2><p>hello.py文件内容中的&quot; Content-type:text/html&quot;即为HTTP头部的一部分，它会发送给浏览器告诉浏览器文件的内容类型。</p><p>HTTP头部的格式如下：</p><pre><span>HTTP </span><span>字段名:</span><span> </span><span>字段内容</span></pre><p>例如：</p><pre><span>Content</span><span>-</span><span>type</span><span>:</span><span> text</span><span>/</span><span>html</span></pre><p>以下表格介绍了CGI程序中HTTP头部经常使用的信息：</p><table><tr><th colspan="1" rowspan="1">头</th><th colspan="1" rowspan="1">描述</th></tr><tr><td colspan="1" rowspan="1">Content-type:</td><td colspan="1" rowspan="1">请求的与实体对应的MIME信息。例如: Content-type:text/html</td></tr><tr><td colspan="1" rowspan="1">Expires: Date</td><td colspan="1" rowspan="1">响应过期的日期和时间</td></tr><tr><td colspan="1" rowspan="1">Location: URL</td><td colspan="1" rowspan="1">用来重定向接收方到非请求URL的位置来完成请求或标识新的资源</td></tr><tr><td colspan="1" rowspan="1">Last-modified: Date</td><td colspan="1" rowspan="1">请求资源的最后修改时间</td></tr><tr><td colspan="1" rowspan="1">Content-length: N</td><td colspan="1" rowspan="1">请求的内容长度</td></tr><tr><td colspan="1" rowspan="1">Set-Cookie: String</td><td colspan="1" rowspan="1">设置Http Cookie</td></tr></table><hr/><h2>CGI环境变量</h2><p>所有的CGI程序都接收以下的环境变量，这些变量在CGI程序中发挥了重要的作用：</p><table><tr><th colspan="1" rowspan="1">变量名</th><th colspan="1" rowspan="1">描述</th></tr><tr><td colspan="1" rowspan="1">CONTENT_TYPE</td><td colspan="1" rowspan="1">这个环境变量的值指示所传递来的信息的MIME类型。目前，环境变量CONTENT_TYPE一般都是：application/x-www-form-urlencoded,他表示数据来自于HTML表单。</td></tr><tr><td colspan="1" rowspan="1">CONTENT_LENGTH</td><td colspan="1" rowspan="1">如果服务器与CGI程序信息的传递方式是POST，这个环境变量即使从标准输入STDIN中可以读到的有效数据的字节数。这个环境变量在读取所输入的数据时必须使用。</td></tr><tr><td colspan="1" rowspan="1">HTTP_COOKIE</td><td colspan="1" rowspan="1">客户机内的 COOKIE 内容。</td></tr><tr><td colspan="1" rowspan="1">HTTP_USER_AGENT</td><td colspan="1" rowspan="1">提供包含了版本数或其他专有数据的客户浏览器信息。</td></tr><tr><td colspan="1" rowspan="1">PATH_INFO</td><td colspan="1" rowspan="1">这个环境变量的值表示紧接在CGI程序名之后的其他路径信息。它常常作为CGI程序的参数出现。</td></tr><tr><td colspan="1" rowspan="1">QUERY_STRING</td><td colspan="1" rowspan="1">如果服务器与CGI程序信息的传递方式是GET，这个环境变量的值即使所传递的信息。这个信息经跟在CGI程序名的后面，两者中间用一个问号'?'分隔。</td></tr><tr><td colspan="1" rowspan="1">REMOTE_ADDR</td><td colspan="1" rowspan="1">这个环境变量的值是发送请求的客户机的IP地址，例如上面的192.168.1.67。这个值总是存在的。而且它是Web客户机需要提供给Web服务器的唯一标识，可以在CGI程序中用它来区分不同的Web客户机。</td></tr><tr><td colspan="1" rowspan="1">REMOTE_HOST</td><td colspan="1" rowspan="1">这个环境变量的值包含发送CGI请求的客户机的主机名。如果不支持你想查询，则无需定义此环境变量。</td></tr><tr><td colspan="1" rowspan="1">REQUEST_METHOD</td><td colspan="1" rowspan="1">提供脚本被调用的方法。对于使用 HTTP/1.0 协议的脚本，仅 GET 和 POST 有意义。</td></tr><tr><td colspan="1" rowspan="1">SCRIPT_FILENAME</td><td colspan="1" rowspan="1">CGI脚本的完整路径</td></tr><tr><td colspan="1" rowspan="1">SCRIPT_NAME</td><td colspan="1" rowspan="1">CGI脚本的的名称</td></tr><tr><td colspan="1" rowspan="1">SERVER_NAME</td><td colspan="1" rowspan="1">这是你的 WEB 服务器的主机名、别名或IP地址。</td></tr><tr><td colspan="1" rowspan="1">SERVER_SOFTWARE</td><td colspan="1" rowspan="1">这个环境变量的值包含了调用CGI程序的HTTP服务器的名称和版本号。例如，上面的值为Apache/2.2.14(Unix)</td></tr></table><p>以下是一个简单的CGI脚本输出CGI的环境变量：</p><pre><span>#!/usr/bin/python</span><span>
</span><span># -*- coding: UTF-8 -*-</span><span>
</span><span># filename:test.py</span><span>

</span><span>import</span><span> os

</span><span>print</span><span> </span><span>&quot;Content-type: text/html&quot;</span><span>
</span><span>print</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;meta charset=\&quot;utf-8\&quot;&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;b&gt;环境变量&lt;/b&gt;&lt;br&gt;&quot;</span><span>;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;ul&gt;&quot;</span><span>
</span><span>for</span><span> key </span><span>in</span><span> os</span><span>.</span><span>environ</span><span>.</span><span>keys</span><span>():</span><span>
    </span><span>print</span><span> </span><span>&quot;&lt;li&gt;&lt;span style='color:green'&gt;%30s &lt;/span&gt; : %s &lt;/li&gt;&quot;</span><span> </span><span>%</span><span> </span><span>(</span><span>key</span><span>,</span><span>os</span><span>.</span><span>environ</span><span>[</span><span>key</span><span>])</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;/ul&gt;&quot;</span></pre><p>将以上点保存为 test.py ,并修改文件权限为 755，执行结果如下：</p><p><img src="Python CGI编程_files/Image.jpg" type="image/jpeg" data-filename="Image.jpg" width="70%"/></p><hr/><h2>GET和POST方法</h2><p>浏览器客户端通过两种方法向服务器传递信息，这两种方法就是 GET 方法和 POST 方法。</p><h3>使用GET方法传输数据</h3><p>GET方法发送编码后的用户信息到服务端，数据信息包含在请求页面的URL上，以&quot;?&quot;号分割, 如下所示：</p><pre><span>http</span><span>:</span><span>//www.test.com/cgi-bin/hello.py?key1=value1&amp;key2=value2</span></pre><span>有关 GET 请求的其他一些注释：</span><ul><li>GET 请求可被缓存</li><li>GET 请求保留在浏览器历史记录中</li><li>GET 请求可被收藏为书签</li><li>GET 请求不应在处理敏感数据时使用</li><li>GET 请求有长度限制</li><li>GET 请求只应当用于取回数据</li></ul><h3>简单的url实例：GET方法</h3><p>以下是一个简单的URL，使用GET方法向hello_get.py程序发送两个参数：</p><pre><span>/cgi-bin/</span><span>test</span><span>.</span><span>py</span><span>?</span><span>name</span><span>=菜鸟教程&amp;</span><span>url</span><span>=</span><span>http</span><span>:</span><span>//www.runoob.com</span></pre><p>以下为hello_get.py文件的代码：</p><pre><span>#!/usr/bin/python</span><span>
</span><span># -*- coding: UTF-8 -*-</span><span>

</span><span># filename：test.py</span><span>

</span><span># CGI处理模块</span><span>
</span><span>import</span><span> cgi</span><span>,</span><span> cgitb 

</span><span># 创建 FieldStorage 的实例化</span><span>
form </span><span>=</span><span> cgi</span><span>.</span><span>FieldStorage</span><span>()</span><span> 

</span><span># 获取数据</span><span>
site_name </span><span>=</span><span> form</span><span>.</span><span>getvalue</span><span>(</span><span>'name'</span><span>)</span><span>
site_url  </span><span>=</span><span> form</span><span>.</span><span>getvalue</span><span>(</span><span>'url'</span><span>)</span><span>

</span><span>print</span><span> </span><span>&quot;Content-type:text/html&quot;</span><span>
</span><span>print</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;html&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;head&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;meta charset=\&quot;utf-8\&quot;&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;title&gt;菜鸟教程 CGI 测试实例&lt;/title&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;/head&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;body&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;h2&gt;%s官网：%s&lt;/h2&gt;&quot;</span><span> </span><span>%</span><span> </span><span>(</span><span>site_name</span><span>,</span><span> site_url</span><span>)</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;/body&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;/html&gt;&quot;</span></pre><p>文件保存后修改 hello_get.py，修改文件权限为 755：</p><pre><span>chmod </span><span>755</span><span> hello_get</span><span>.</span><span>py </span></pre><p>浏览器请求输出结果：</p><p><img src="Python CGI编程_files/Image [1].jpg" type="image/jpeg" data-filename="Image.jpg"/></p><h3>简单的表单实例：GET方法</h3><p>以下是一个通过HTML的表单使用GET方法向服务器发送两个数据，提交的服务器脚本同样是hello_get.py文件，hello_get.html 代码如下：</p><pre><span>&lt;!DOCTYPE html&gt;</span><span>
</span><span>&lt;html&gt;</span><span>
</span><span>&lt;head&gt;</span><span>
</span><span>&lt;meta</span><span> </span><span>charset</span><span>=</span><span>&quot;utf-8&quot;</span><span>&gt;</span><span>
</span><span>&lt;title&gt;</span><span>菜鸟教程(runoob.com)</span><span>&lt;/title&gt;</span><span>
</span><span>&lt;/head&gt;</span><span>
</span><span>&lt;body&gt;</span><span>
</span><span>&lt;form</span><span> </span><span>action</span><span>=</span><span>&quot;/cgi-bin/hello_get.py&quot;</span><span> </span><span>method</span><span>=</span><span>&quot;get&quot;</span><span>&gt;</span><span>
站点名称: </span><span>&lt;input</span><span> </span><span>type</span><span>=</span><span>&quot;text&quot;</span><span> </span><span>name</span><span>=</span><span>&quot;name&quot;</span><span>&gt;</span><span>  </span><span>&lt;br</span><span> </span><span>/&gt;</span><span>

站点 URL: </span><span>&lt;input</span><span> </span><span>type</span><span>=</span><span>&quot;text&quot;</span><span> </span><span>name</span><span>=</span><span>&quot;url&quot;</span><span> </span><span>/&gt;</span><span>
</span><span>&lt;input</span><span> </span><span>type</span><span>=</span><span>&quot;submit&quot;</span><span> </span><span>value</span><span>=</span><span>&quot;提交&quot;</span><span> </span><span>/&gt;</span><span>
</span><span>&lt;/form&gt;</span><span>
</span><span>&lt;/body&gt;</span><span>
</span><span>&lt;/html&gt;</span></pre><p>默认情况下 cgi-bin 目录只能存放脚本文件，我们将 hello_get.html 存储在 test 目录下，修改文件权限为 755：</p><pre><span>chmod </span><span>755</span><span> hello_get</span><span>.</span><span>html</span></pre><p>Gif 演示如下所示：</p><p><img src="Python CGI编程_files/Image.gif" type="image/gif" data-filename="Image.gif"/></p><h3>使用POST方法传递数据</h3><p>使用POST方法向服务器传递数据是更安全可靠的，像一些敏感信息如用户密码等需要使用POST传输数据。</p><p>以下同样是hello_get.py ，它也可以处理浏览器提交的POST表单数据:</p><pre><span>#!/usr/bin/python</span><span>
</span><span># -*- coding: UTF-8 -*-</span><span>

</span><span># CGI处理模块</span><span>
</span><span>import</span><span> cgi</span><span>,</span><span> cgitb 

</span><span># 创建 FieldStorage 的实例化</span><span>
form </span><span>=</span><span> cgi</span><span>.</span><span>FieldStorage</span><span>()</span><span> 

</span><span># 获取数据</span><span>
site_name </span><span>=</span><span> form</span><span>.</span><span>getvalue</span><span>(</span><span>'name'</span><span>)</span><span>
site_url  </span><span>=</span><span> form</span><span>.</span><span>getvalue</span><span>(</span><span>'url'</span><span>)</span><span>

</span><span>print</span><span> </span><span>&quot;Content-type:text/html&quot;</span><span>
</span><span>print</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;html&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;head&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;meta charset=\&quot;utf-8\&quot;&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;title&gt;菜鸟教程 CGI 测试实例&lt;/title&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;/head&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;body&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;h2&gt;%s官网：%s&lt;/h2&gt;&quot;</span><span> </span><span>%</span><span> </span><span>(</span><span>site_name</span><span>,</span><span> site_url</span><span>)</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;/body&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;/html&gt;&quot;</span></pre><p>以下为表单通过POST方法（<strong>method=&quot;post&quot;</strong>）向服务器脚本 hello_get.py 提交数据:</p><pre><span>&lt;!DOCTYPE html&gt;</span><span>
</span><span>&lt;html&gt;</span><span>
</span><span>&lt;head&gt;</span><span>
</span><span>&lt;meta</span><span> </span><span>charset</span><span>=</span><span>&quot;utf-8&quot;</span><span>&gt;</span><span>
</span><span>&lt;title&gt;</span><span>菜鸟教程(runoob.com)</span><span>&lt;/title&gt;</span><span>
</span><span>&lt;/head&gt;</span><span>
</span><span>&lt;body&gt;</span><span>
</span><span>&lt;form</span><span> </span><span>action</span><span>=</span><span>&quot;/cgi-bin/hello_get.py&quot;</span><span> </span><span>method</span><span>=</span><span>&quot;post&quot;</span><span>&gt;</span><span>
站点名称: </span><span>&lt;input</span><span> </span><span>type</span><span>=</span><span>&quot;text&quot;</span><span> </span><span>name</span><span>=</span><span>&quot;name&quot;</span><span>&gt;</span><span>  </span><span>&lt;br</span><span> </span><span>/&gt;</span><span>

站点 URL: </span><span>&lt;input</span><span> </span><span>type</span><span>=</span><span>&quot;text&quot;</span><span> </span><span>name</span><span>=</span><span>&quot;url&quot;</span><span> </span><span>/&gt;</span><span>
</span><span>&lt;input</span><span> </span><span>type</span><span>=</span><span>&quot;submit&quot;</span><span> </span><span>value</span><span>=</span><span>&quot;提交&quot;</span><span> </span><span>/&gt;</span><span>
</span><span>&lt;/form&gt;</span><span>
</span><span>&lt;/body&gt;</span><span>
</span><span>&lt;/html&gt;</span></pre><p>Gif 演示如下所示：</p><p><img src="Python CGI编程_files/Image [1].gif" type="image/gif" data-filename="Image.gif"/></p><h3>通过CGI程序传递checkbox数据</h3><p>checkbox用于提交一个或者多个选项数据，HTML代码如下：</p><pre><span>&lt;!DOCTYPE html&gt;</span><span>
</span><span>&lt;html&gt;</span><span>
</span><span>&lt;head&gt;</span><span>
</span><span>&lt;meta</span><span> </span><span>charset</span><span>=</span><span>&quot;utf-8&quot;</span><span>&gt;</span><span>
</span><span>&lt;title&gt;</span><span>菜鸟教程(runoob.com)</span><span>&lt;/title&gt;</span><span>
</span><span>&lt;/head&gt;</span><span>
</span><span>&lt;body&gt;</span><span>
</span><span>&lt;form</span><span> </span><span>action</span><span>=</span><span>&quot;/cgi-bin/checkbox.py&quot;</span><span> </span><span>method</span><span>=</span><span>&quot;POST&quot;</span><span> </span><span>target</span><span>=</span><span>&quot;_blank&quot;</span><span>&gt;</span><span>
</span><span>&lt;input</span><span> </span><span>type</span><span>=</span><span>&quot;checkbox&quot;</span><span> </span><span>name</span><span>=</span><span>&quot;runoob&quot;</span><span> </span><span>value</span><span>=</span><span>&quot;on&quot;</span><span> </span><span>/&gt;</span><span> 菜鸟教程
</span><span>&lt;input</span><span> </span><span>type</span><span>=</span><span>&quot;checkbox&quot;</span><span> </span><span>name</span><span>=</span><span>&quot;google&quot;</span><span> </span><span>value</span><span>=</span><span>&quot;on&quot;</span><span> </span><span>/&gt;</span><span> Google
</span><span>&lt;input</span><span> </span><span>type</span><span>=</span><span>&quot;submit&quot;</span><span> </span><span>value</span><span>=</span><span>&quot;选择站点&quot;</span><span> </span><span>/&gt;</span><span>
</span><span>&lt;/form&gt;</span><span>
</span><span>&lt;/body&gt;</span><span>
</span><span>&lt;/html&gt;</span></pre><p>以下为 checkbox.py 文件的代码：</p><pre><span>#!/usr/bin/python</span><span>
</span><span># -*- coding: UTF-8 -*-</span><span>

</span><span># 引入 CGI 处理模块 </span><span>
</span><span>import</span><span> cgi</span><span>,</span><span> cgitb 

</span><span># 创建 FieldStorage的实例 </span><span>
form </span><span>=</span><span> cgi</span><span>.</span><span>FieldStorage</span><span>()</span><span> 

</span><span># 接收字段数据</span><span>
</span><span>if</span><span> form</span><span>.</span><span>getvalue</span><span>(</span><span>'google'</span><span>):</span><span>
   google_flag </span><span>=</span><span> </span><span>&quot;是&quot;</span><span>
</span><span>else</span><span>:</span><span>
   google_flag </span><span>=</span><span> </span><span>&quot;否&quot;</span><span>

</span><span>if</span><span> form</span><span>.</span><span>getvalue</span><span>(</span><span>'runoob'</span><span>):</span><span>
   runoob_flag </span><span>=</span><span> </span><span>&quot;是&quot;</span><span>
</span><span>else</span><span>:</span><span>
   runoob_flag </span><span>=</span><span> </span><span>&quot;否&quot;</span><span>

</span><span>print</span><span> </span><span>&quot;Content-type:text/html&quot;</span><span>
</span><span>print</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;html&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;head&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;meta charset=\&quot;utf-8\&quot;&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;title&gt;菜鸟教程 CGI 测试实例&lt;/title&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;/head&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;body&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;h2&gt; 菜鸟教程是否选择了 : %s&lt;/h2&gt;&quot;</span><span> </span><span>%</span><span> runoob_flag
</span><span>print</span><span> </span><span>&quot;&lt;h2&gt; Google 是否选择了 : %s&lt;/h2&gt;&quot;</span><span> </span><span>%</span><span> google_flag
</span><span>print</span><span> </span><span>&quot;&lt;/body&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;/html&gt;&quot;</span></pre><p>修改 checkbox.py 权限：</p><pre><span>chmod </span><span>755</span><span> checkbox</span><span>.</span><span>py</span></pre><p>浏览器访问 Gif 演示图：</p><p><img src="Python CGI编程_files/Image [2].gif" type="image/gif" data-filename="Image.gif"/></p><h3>通过CGI程序传递Radio数据</h3><p>Radio 只向服务器传递一个数据，HTML代码如下：</p><pre><span>&lt;!DOCTYPE html&gt;</span><span>
</span><span>&lt;html&gt;</span><span>
</span><span>&lt;head&gt;</span><span>
</span><span>&lt;meta</span><span> </span><span>charset</span><span>=</span><span>&quot;utf-8&quot;</span><span>&gt;</span><span>
</span><span>&lt;title&gt;</span><span>菜鸟教程(runoob.com)</span><span>&lt;/title&gt;</span><span>
</span><span>&lt;/head&gt;</span><span>
</span><span>&lt;body&gt;</span><span>
</span><span>&lt;form</span><span> </span><span>action</span><span>=</span><span>&quot;/cgi-bin/radiobutton.py&quot;</span><span> </span><span>method</span><span>=</span><span>&quot;post&quot;</span><span> </span><span>target</span><span>=</span><span>&quot;_blank&quot;</span><span>&gt;</span><span>
</span><span>&lt;input</span><span> </span><span>type</span><span>=</span><span>&quot;radio&quot;</span><span> </span><span>name</span><span>=</span><span>&quot;site&quot;</span><span> </span><span>value</span><span>=</span><span>&quot;runoob&quot;</span><span> </span><span>/&gt;</span><span> 菜鸟教程
</span><span>&lt;input</span><span> </span><span>type</span><span>=</span><span>&quot;radio&quot;</span><span> </span><span>name</span><span>=</span><span>&quot;site&quot;</span><span> </span><span>value</span><span>=</span><span>&quot;google&quot;</span><span> </span><span>/&gt;</span><span> Google
</span><span>&lt;input</span><span> </span><span>type</span><span>=</span><span>&quot;submit&quot;</span><span> </span><span>value</span><span>=</span><span>&quot;提交&quot;</span><span> </span><span>/&gt;</span><span>
</span><span>&lt;/form&gt;</span><span>
</span><span>&lt;/body&gt;</span><span>
</span><span>&lt;/html&gt;</span></pre><p>radiobutton.py 脚本代码如下：</p><pre><span>#!/usr/bin/python</span><span>
</span><span># -*- coding: UTF-8 -*-</span><span>

</span><span># 引入 CGI 处理模块 </span><span>
</span><span>import</span><span> cgi</span><span>,</span><span> cgitb 

</span><span># 创建 FieldStorage的实例 </span><span>
form </span><span>=</span><span> cgi</span><span>.</span><span>FieldStorage</span><span>()</span><span> 

</span><span># 接收字段数据</span><span>
</span><span>if</span><span> form</span><span>.</span><span>getvalue</span><span>(</span><span>'site'</span><span>):</span><span>
   site </span><span>=</span><span> form</span><span>.</span><span>getvalue</span><span>(</span><span>'site'</span><span>)</span><span>
</span><span>else</span><span>:</span><span>
   site </span><span>=</span><span> </span><span>&quot;提交数据为空&quot;</span><span>

</span><span>print</span><span> </span><span>&quot;Content-type:text/html&quot;</span><span>
</span><span>print</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;html&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;head&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;meta charset=\&quot;utf-8\&quot;&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;title&gt;菜鸟教程 CGI 测试实例&lt;/title&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;/head&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;body&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;h2&gt; 选中的网站是 %s&lt;/h2&gt;&quot;</span><span> </span><span>%</span><span> site
</span><span>print</span><span> </span><span>&quot;&lt;/body&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;/html&gt;&quot;</span></pre><p>修改 radiobutton.py 权限：</p><pre><span>chmod </span><span>755</span><span> radiobutton</span><span>.</span><span>py</span></pre><p>浏览器访问 Gif 演示图：</p><p><img src="Python CGI编程_files/Image [3].gif" type="image/gif" data-filename="Image.gif"/></p><h3>通过CGI程序传递 Textarea 数据</h3><p>Textarea 向服务器传递多行数据，HTML代码如下：</p><pre><span>&lt;!DOCTYPE html&gt;</span><span>
</span><span>&lt;html&gt;</span><span>
</span><span>&lt;head&gt;</span><span>
</span><span>&lt;meta</span><span> </span><span>charset</span><span>=</span><span>&quot;utf-8&quot;</span><span>&gt;</span><span>
</span><span>&lt;title&gt;</span><span>菜鸟教程(runoob.com)</span><span>&lt;/title&gt;</span><span>
</span><span>&lt;/head&gt;</span><span>
</span><span>&lt;body&gt;</span><span>
</span><span>&lt;form</span><span> </span><span>action</span><span>=</span><span>&quot;/cgi-bin/textarea.py&quot;</span><span> </span><span>method</span><span>=</span><span>&quot;post&quot;</span><span> </span><span>target</span><span>=</span><span>&quot;_blank&quot;</span><span>&gt;</span><span>
</span><span>&lt;textarea</span><span> </span><span>name</span><span>=</span><span>&quot;textcontent&quot;</span><span> </span><span>cols</span><span>=</span><span>&quot;40&quot;</span><span> </span><span>rows</span><span>=</span><span>&quot;4&quot;</span><span>&gt;</span><span>
在这里输入内容...
</span><span>&lt;/textarea&gt;</span><span>
</span><span>&lt;input</span><span> </span><span>type</span><span>=</span><span>&quot;submit&quot;</span><span> </span><span>value</span><span>=</span><span>&quot;提交&quot;</span><span> </span><span>/&gt;</span><span>
</span><span>&lt;/form&gt;</span><span>
</span><span>&lt;/body&gt;</span><span>
</span><span>&lt;/html&gt;</span></pre><p>textarea.py 脚本代码如下：</p><pre><span>#!/usr/bin/python</span><span>
</span><span># -*- coding: UTF-8 -*-</span><span>

</span><span># 引入 CGI 处理模块 </span><span>
</span><span>import</span><span> cgi</span><span>,</span><span> cgitb 

</span><span># 创建 FieldStorage的实例 </span><span>
form </span><span>=</span><span> cgi</span><span>.</span><span>FieldStorage</span><span>()</span><span> 

</span><span># 接收字段数据</span><span>
</span><span>if</span><span> form</span><span>.</span><span>getvalue</span><span>(</span><span>'textcontent'</span><span>):</span><span>
   text_content </span><span>=</span><span> form</span><span>.</span><span>getvalue</span><span>(</span><span>'textcontent'</span><span>)</span><span>
</span><span>else</span><span>:</span><span>
   text_content </span><span>=</span><span> </span><span>&quot;没有内容&quot;</span><span>

</span><span>print</span><span> </span><span>&quot;Content-type:text/html&quot;</span><span>
</span><span>print</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;html&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;head&gt;&quot;</span><span>;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;meta charset=\&quot;utf-8\&quot;&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;title&gt;菜鸟教程 CGI 测试实例&lt;/title&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;/head&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;body&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;h2&gt; 输入的内容是：%s&lt;/h2&gt;&quot;</span><span> </span><span>%</span><span> text_content
</span><span>print</span><span> </span><span>&quot;&lt;/body&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;/html&gt;&quot;</span></pre><p>修改 textarea.py 权限：</p><pre><span>chmod </span><span>755</span><span> textarea</span><span>.</span><span>py</span></pre><p>浏览器访问 Gif 演示图：</p><p><img src="Python CGI编程_files/Image [4].gif" type="image/gif" data-filename="Image.gif"/></p><h3>通过CGI程序传递下拉数据。</h3><p>HTML 下拉框代码如下：</p><pre><span>&lt;!DOCTYPE html&gt;</span><span>
</span><span>&lt;html&gt;</span><span>
</span><span>&lt;head&gt;</span><span>
</span><span>&lt;meta</span><span> </span><span>charset</span><span>=</span><span>&quot;utf-8&quot;</span><span>&gt;</span><span>
</span><span>&lt;title&gt;</span><span>菜鸟教程(runoob.com)</span><span>&lt;/title&gt;</span><span>
</span><span>&lt;/head&gt;</span><span>
</span><span>&lt;body&gt;</span><span>
</span><span>&lt;form</span><span> </span><span>action</span><span>=</span><span>&quot;/cgi-bin/dropdown.py&quot;</span><span> </span><span>method</span><span>=</span><span>&quot;post&quot;</span><span> </span><span>target</span><span>=</span><span>&quot;_blank&quot;</span><span>&gt;</span><span>
</span><span>&lt;select</span><span> </span><span>name</span><span>=</span><span>&quot;dropdown&quot;</span><span>&gt;</span><span>
</span><span>&lt;option</span><span> </span><span>value</span><span>=</span><span>&quot;runoob&quot;</span><span> </span><span>selected</span><span>&gt;</span><span>菜鸟教程</span><span>&lt;/option&gt;</span><span>
</span><span>&lt;option</span><span> </span><span>value</span><span>=</span><span>&quot;google&quot;</span><span>&gt;</span><span>Google</span><span>&lt;/option&gt;</span><span>
</span><span>&lt;/select&gt;</span><span>
</span><span>&lt;input</span><span> </span><span>type</span><span>=</span><span>&quot;submit&quot;</span><span> </span><span>value</span><span>=</span><span>&quot;提交&quot;</span><span>/&gt;</span><span>
</span><span>&lt;/form&gt;</span><span>
</span><span>&lt;/body&gt;</span><span>
</span><span>&lt;/html&gt;</span></pre><p>dropdown.py 脚本代码如下所示：</p><pre><span>#!/usr/bin/python</span><span>
</span><span># -*- coding: UTF-8 -*-</span><span>

</span><span># 引入 CGI 处理模块 </span><span>
</span><span>import</span><span> cgi</span><span>,</span><span> cgitb 

</span><span># 创建 FieldStorage的实例 </span><span>
form </span><span>=</span><span> cgi</span><span>.</span><span>FieldStorage</span><span>()</span><span> 

</span><span># 接收字段数据</span><span>
</span><span>if</span><span> form</span><span>.</span><span>getvalue</span><span>(</span><span>'dropdown'</span><span>):</span><span>
   dropdown_value </span><span>=</span><span> form</span><span>.</span><span>getvalue</span><span>(</span><span>'dropdown'</span><span>)</span><span>
</span><span>else</span><span>:</span><span>
   dropdown_value </span><span>=</span><span> </span><span>&quot;没有内容&quot;</span><span>

</span><span>print</span><span> </span><span>&quot;Content-type:text/html&quot;</span><span>
</span><span>print</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;html&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;head&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;meta charset=\&quot;utf-8\&quot;&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;title&gt;菜鸟教程 CGI 测试实例&lt;/title&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;/head&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;body&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;h2&gt; 选中的选项是：%s&lt;/h2&gt;&quot;</span><span> </span><span>%</span><span> dropdown_value
</span><span>print</span><span> </span><span>&quot;&lt;/body&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&lt;/html&gt;&quot;</span></pre><p>修改 dropdown.py 权限：</p><pre><span>chmod </span><span>755</span><span> dropdown</span><span>.</span><span>py</span></pre><p>浏览器访问 Gif 演示图：</p><p><img src="Python CGI编程_files/Image [5].gif" type="image/gif" data-filename="Image.gif"/></p><hr/><h2>CGI中使用Cookie</h2><p>在 http 协议一个很大的缺点就是不对用户身份的进行判断，这样给编程人员带来很大的不便， 而 cookie 功能的出现弥补了这个不足。</p><p>cookie 就是在客户访问脚本的同时，通过客户的浏览器，在客户硬盘上写入纪录数据 ，当下次客户访问脚本时取回数据信息，从而达到身份判别的功能，cookie 常用在身份校验中。</p><span>　</span><h3>cookie的语法</h3><p>http cookie的发送是通过http头部来实现的，他早于文件的传递，头部set-cookie的语法如下：</p><pre><span>Set</span><span>-</span><span>cookie</span><span>:</span><span>name</span><span>=</span><span>name</span><span>;</span><span>expires</span><span>=</span><span>date</span><span>;</span><span>path</span><span>=</span><span>path</span><span>;</span><span>domain</span><span>=</span><span>domain</span><span>;</span><span>secure </span></pre><ul><li><strong>name=name:</strong> 需要设置cookie的值(name不能使用&quot;<strong>;</strong>&quot;和&quot;<strong>,</strong>&quot;号),有多个name值时用 &quot;<strong>;</strong>&quot; 分隔，例如：<strong>name1=name1;name2=name2;name3=name3</strong>。</li><li><strong>expires=date:</strong> cookie的有效期限,格式： expires=&quot;Wdy,DD-Mon-YYYY HH:MM:SS&quot;</li><li><br clear="none"/></li><li><strong>path=path: </strong>设置cookie支持的路径,如果path是一个路径，则cookie对这个目录下的所有文件及子目录生效，例如： path=&quot;/cgi-bin/&quot;，如果path是一个文件，则cookie指对这个文件生效，例如：path=&quot;/cgi-bin/cookie.cgi&quot;。</li><li><strong>domain=domain:</strong> 对cookie生效的域名，例如：domain=&quot;www.runoob.com&quot;</li><li><strong>secure:</strong> 如果给出此标志，表示cookie只能通过SSL协议的https服务器来传递。</li><li>cookie的接收是通过设置环境变量HTTP_COOKIE来实现的，CGI程序可以通过检索该变量获取cookie信息。</li></ul><hr/><h2>Cookie设置</h2><p>Cookie的设置非常简单，cookie会在http头部单独发送。以下实例在cookie中设置了name 和 expires：</p><pre><span>#!/usr/bin/python</span><span>
</span><span># -*- coding: UTF-8 -*-</span><span>
</span><span># </span><span>
</span><span>print</span><span> </span><span>'Content-Type: text/html'</span><span>
</span><span>print</span><span> </span><span>'Set-Cookie: name=&quot;菜鸟教程&quot;;expires=Wed, 28 Aug 2016 18:30:00 GMT'</span><span>
</span><span>print</span><span>
</span><span>print</span><span> </span><span>&quot;&quot;&quot;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;</span><span>utf</span><span>-</span><span>8</span><span>&quot;&gt;
        &lt;title&gt;菜鸟教程(runoob.com)&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Cookie set OK!&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;
&quot;&quot;&quot;</span></pre><p>将以上代码保存到 cookie_set.py，并修改 cookie_set.py 权限：</p><pre><span>chmod </span><span>755</span><span> cookie_set</span><span>.</span><span>py</span></pre><p>以上实例使用了 Set-Cookie 头信息来设置Cookie信息，可选项中设置了Cookie的其他属性，如过期时间Expires，域名Domain，路径Path。这些信息设置在 &quot;Content-type:text/html&quot;之前。</p><hr/><h2>检索Cookie信息</h2><p>Cookie信息检索页非常简单，Cookie信息存储在CGI的环境变量HTTP_COOKIE中，存储格式如下：</p><pre><span>key1</span><span>=</span><span>value1</span><span>;</span><span>key2</span><span>=</span><span>value2</span><span>;</span><span>key3</span><span>=</span><span>value3</span><span>....</span></pre><p>以下是一个简单的CGI检索cookie信息的程序：</p><pre><span>#!/usr/bin/python</span><span>
</span><span># -*- coding: UTF-8 -*-</span><span>

</span><span># 导入模块</span><span>
</span><span>import</span><span> os
</span><span>import</span><span> </span><span>Cookie</span><span>

</span><span>print</span><span> </span><span>&quot;Content-type: text/html&quot;</span><span>
</span><span>print</span><span>

</span><span>print</span><span> </span><span>&quot;&quot;&quot;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;</span><span>utf</span><span>-</span><span>8</span><span>&quot;&gt;
&lt;title&gt;菜鸟教程(runoob.com)&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;读取cookie信息&lt;/h1&gt;
&quot;&quot;&quot;</span><span>

</span><span>if</span><span> </span><span>'HTTP_COOKIE'</span><span> </span><span>in</span><span> os</span><span>.</span><span>environ</span><span>:</span><span>
    cookie_string</span><span>=</span><span>os</span><span>.</span><span>environ</span><span>.</span><span>get</span><span>(</span><span>'HTTP_COOKIE'</span><span>)</span><span>
    c</span><span>=</span><span>Cookie</span><span>.</span><span>SimpleCookie</span><span>()</span><span>
    c</span><span>.</span><span>load</span><span>(</span><span>cookie_string</span><span>)</span><span>

    </span><span>try</span><span>:</span><span>
        data</span><span>=</span><span>c</span><span>[</span><span>'name'</span><span>].</span><span>value
        </span><span>print</span><span> </span><span>&quot;cookie data: &quot;</span><span>+</span><span>data</span><span>+</span><span>&quot;&lt;br&gt;&quot;</span><span>
    </span><span>except</span><span> </span><span>KeyError</span><span>:</span><span>
        </span><span>print</span><span> </span><span>&quot;cookie 没有设置或者已过去&lt;br&gt;&quot;</span><span>
</span><span>print</span><span> </span><span>&quot;&quot;&quot;
&lt;/body&gt;
&lt;/html&gt;

&quot;&quot;&quot;</span></pre><p>将以上代码保存到 cookie_get.py，并修改 cookie_get.py 权限：</p><pre><span>chmod </span><span>755</span><span> cookie_get</span><span>.</span><span>py</span></pre><p>以上 cookie 设置颜色 Gif 如下所示：</p><p><img src="Python CGI编程_files/Image [6].gif" type="image/gif" data-filename="Image.gif"/></p><h3>文件上传实例</h3><p>HTML设置上传文件的表单需要设置 <strong>enctype</strong> 属性为 <strong>multipart/form-data</strong>，代码如下所示：</p><pre><span>&lt;!DOCTYPE html&gt;</span><span>
</span><span>&lt;html&gt;</span><span>
</span><span>&lt;head&gt;</span><span>
</span><span>&lt;meta</span><span> </span><span>charset</span><span>=</span><span>&quot;utf-8&quot;</span><span>&gt;</span><span>
</span><span>&lt;title&gt;</span><span>菜鸟教程(runoob.com)</span><span>&lt;/title&gt;</span><span>
</span><span>&lt;/head&gt;</span><span>
</span><span>&lt;body&gt;</span><span>
 </span><span>&lt;form</span><span> </span><span>enctype</span><span>=</span><span>&quot;multipart/form-data&quot;</span><span> 
                     </span><span>action</span><span>=</span><span>&quot;/cgi-bin/save_file.py&quot;</span><span> </span><span>method</span><span>=</span><span>&quot;post&quot;</span><span>&gt;</span><span>
   </span><span>&lt;p&gt;</span><span>选中文件: </span><span>&lt;input</span><span> </span><span>type</span><span>=</span><span>&quot;file&quot;</span><span> </span><span>name</span><span>=</span><span>&quot;filename&quot;</span><span> </span><span>/&gt;&lt;/p&gt;</span><span>
   </span><span>&lt;p&gt;&lt;input</span><span> </span><span>type</span><span>=</span><span>&quot;submit&quot;</span><span> </span><span>value</span><span>=</span><span>&quot;上传&quot;</span><span> </span><span>/&gt;&lt;/p&gt;</span><span>
   </span><span>&lt;/form&gt;</span><span>
</span><span>&lt;/body&gt;</span><span>
</span><span>&lt;/html&gt;</span></pre><p>save_file.py脚本文件代码如下：</p><pre><span>#!/usr/bin/python</span><span>
</span><span># -*- coding: UTF-8 -*-</span><span>

</span><span>import</span><span> cgi</span><span>,</span><span> os
</span><span>import</span><span> cgitb</span><span>;</span><span> cgitb</span><span>.</span><span>enable</span><span>()</span><span>

form </span><span>=</span><span> cgi</span><span>.</span><span>FieldStorage</span><span>()</span><span>

</span><span># 获取文件名</span><span>
fileitem </span><span>=</span><span> form</span><span>[</span><span>'filename'</span><span>]</span><span>

</span><span># 检测文件是否上传</span><span>
</span><span>if</span><span> fileitem</span><span>.</span><span>filename</span><span>:</span><span>
   </span><span># 设置文件路径 </span><span>
   fn </span><span>=</span><span> os</span><span>.</span><span>path</span><span>.</span><span>basename</span><span>(</span><span>fileitem</span><span>.</span><span>filename</span><span>)</span><span>
   open</span><span>(</span><span>'/tmp/'</span><span> </span><span>+</span><span> fn</span><span>,</span><span> </span><span>'wb'</span><span>).</span><span>write</span><span>(</span><span>fileitem</span><span>.</span><span>file</span><span>.</span><span>read</span><span>())</span><span>

   message </span><span>=</span><span> </span><span>'文件 &quot;'</span><span> </span><span>+</span><span> fn </span><span>+</span><span> </span><span>'&quot; 上传成功'</span><span>
   
</span><span>else</span><span>:</span><span>
   message </span><span>=</span><span> </span><span>'文件没有上传'</span><span>
   
</span><span>print</span><span> </span><span>&quot;&quot;&quot;\
Content-Type: text/html\n
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;</span><span>utf</span><span>-</span><span>8</span><span>&quot;&gt;
&lt;title&gt;菜鸟教程(runoob.com)&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
   &lt;p&gt;%s&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
&quot;&quot;&quot;</span><span> </span><span>%</span><span> </span><span>(</span><span>message</span><span>,)</span></pre><p>将以上代码保存到 save_file.py，并修改 save_file.py 权限：</p><pre><span>chmod </span><span>755</span><span> save_file</span><span>.</span><span>py</span></pre><p>以上 cookie 设置颜色 Gif 如下所示：</p><p><img src="Python CGI编程_files/Image [7].gif" type="image/gif" data-filename="Image.gif"/></p><p>如果你使用的系统是Unix/Linux，你必须替换文件分隔符，在window下只需要使用open()语句即可：</p><pre><span>fn </span><span>=</span><span> os</span><span>.</span><span>path</span><span>.</span><span>basename</span><span>(</span><span>fileitem</span><span>.</span><span>filename</span><span>.</span><span>replace</span><span>(</span><span>&quot;\\&quot;</span><span>,</span><span> </span><span>&quot;/&quot;</span><span> </span><span>))</span></pre><hr/><h2>文件下载对话框</h2><p>我们先在当前目录下创建 foo.txt 文件，用于程序的下载。</p><p>文件下载通过设置HTTP头信息来实现，功能代码如下：</p><pre><span>#!/usr/bin/python</span><span>
</span><span># -*- coding: UTF-8 -*-</span><span>

</span><span># HTTP 头部</span><span>
</span><span>print</span><span> </span><span>&quot;Content-Disposition: attachment; filename=\&quot;foo.txt\&quot;&quot;</span><span>;</span><span>
</span><span>print</span><span>
</span><span># 打开文件</span><span>
fo </span><span>=</span><span> open</span><span>(</span><span>&quot;foo.txt&quot;</span><span>,</span><span> </span><span>&quot;rb&quot;</span><span>)</span><span>

str </span><span>=</span><span> fo</span><span>.</span><span>read</span><span>();</span><span>
</span><span>print</span><span> str

</span><span># 关闭文件</span><span>
fo</span><span>.</span><span>close</span><span>()</span></pre><br clear="none"/></div></span>
</div></body></html> 